# AgentGateway Demo Configuration
#
# This config demonstrates all major patterns:
# - MCP multiplexing (multiple backend servers)
# - Virtual tools (renaming, output projection)
# - A2A agent proxying
# - Tool composition (pipelines)
#
# Usage:
#   # Start custom MCP services first:
#   ./start_mcp_services.sh
#
#   # Then start the gateway:
#   agentgateway -f examples/pattern-demos/configs/demo-config.yaml
#
# Connect with:
#   - MCP Inspector: npx @modelcontextprotocol/inspector http://localhost:3000/mcp
#   - Claude Desktop: Configure as SSE transport at http://localhost:3000/sse
#   - Admin UI: http://localhost:15000/ui

config:
  adminAddr: "127.0.0.1:15000"
  logging:
    format: json
    fields:
      add:
        demo: pattern-demos

binds:
# Main MCP/HTTP endpoint
- port: 3000
  listeners:
  - routes:
    # Route 1: MCP traffic with all tools (pre-built + custom)
    - matches:
      - path:
          pathPrefix: /mcp
      policies:
        cors:
          allowOrigins:
          - "*"
          allowHeaders:
          - mcp-protocol-version
          - content-type
          - cache-control
          - mcp-session-id
      backends:
      - mcp:
          targets:
          # ========================================
          # Pre-built MCP servers (via stdio)
          # ========================================
          
          # Fetch server - web content retrieval
          - name: fetch-server
            stdio:
              cmd: uvx
              args: ["mcp-server-fetch"]

          # Memory server - knowledge graph
          - name: memory-server
            stdio:
              cmd: npx
              args: ["-y", "@modelcontextprotocol/server-memory"]

          # Time server - timezone operations
          - name: time-server
            stdio:
              cmd: uvx
              args: ["mcp-server-time"]

          # Everything server - comprehensive demo
          - name: everything-server
            stdio:
              cmd: npx
              args: ["-y", "@modelcontextprotocol/server-everything"]

          # ========================================
          # Custom MCP services (via streamable-http)
          # Start with: ./start_mcp_services.sh
          # ========================================
          
          # Document service - semantic search with sqlite-vec
          - name: document-service
            mcp:
              host: "http://localhost:8001"

          # Task service - task management with state history
          - name: task-service
            mcp:
              host: "http://localhost:8002"

          # User service - user profiles with bio search
          - name: user-service
            mcp:
              host: "http://localhost:8003"

          # Notification service - async notifications
          - name: notification-service
            mcp:
              host: "http://localhost:8004"

    # Route 2: SSE transport (same backends)
    - matches:
      - path:
          pathPrefix: /sse
      policies:
        cors:
          allowOrigins:
          - "*"
          allowHeaders:
          - content-type
          - cache-control
      backends:
      - mcp:
          targets:
          # Pre-built servers
          - name: fetch-server
            stdio:
              cmd: uvx
              args: ["mcp-server-fetch"]
          - name: memory-server
            stdio:
              cmd: npx
              args: ["-y", "@modelcontextprotocol/server-memory"]
          - name: time-server
            stdio:
              cmd: uvx
              args: ["mcp-server-time"]
          
          # Custom services (HTTP)
          - name: document-service
            mcp:
              host: "http://localhost:8001"
          - name: task-service
            mcp:
              host: "http://localhost:8002"
          - name: user-service
            mcp:
              host: "http://localhost:8003"
          - name: notification-service
            mcp:
              host: "http://localhost:8004"

    # Route 3: A2A agent proxy
    - matches:
      - path:
          pathPrefix: /a2a
      policies:
        cors:
          allowOrigins:
          - "*"
          allowHeaders:
          - content-type
          - cache-control
        a2a: {}
      backends:
      - host: localhost:9999

# Registry for virtual tool mappings
# This provides tool renaming, output projection, compositions, etc.
# Using v2 registry with sophisticated patterns: pipelines, scatter-gather, sagas
registry:
  source: file://./examples/pattern-demos/configs/registry-v2-example.json
  refreshInterval: 30s
