{
  "schemaVersion": "2.0",

  "schemas": [
    {
      "name": "ProductSummary",
      "version": "1.0.0",
      "description": "Basic product info shown in search results and listings",
      "schema": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "name": {"type": "string"},
          "price": {"type": "number"},
          "description": {"type": "string"},
          "in_stock": {"type": "boolean"}
        }
      }
    },
    {
      "name": "ProductListOutput",
      "version": "1.0.0",
      "description": "Standard product search/list result",
      "schema": {
        "type": "object",
        "properties": {
          "products": {
            "type": "array",
            "items": {"$ref": "#ProductSummary"}
          },
          "total_found": {"type": "integer"}
        }
      }
    },
    {
      "name": "PersonalizedProduct",
      "version": "1.0.0",
      "description": "Product with personalization scores",
      "schema": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "name": {"type": "string"},
          "price": {"type": "number"},
          "relevance_score": {"type": "number"},
          "personalization_boost": {"type": "number"}
        }
      }
    },
    {
      "name": "PersonalizedSearchOutput",
      "version": "1.0.0",
      "description": "Personalized search results",
      "schema": {
        "type": "object",
        "properties": {
          "products": {
            "type": "array",
            "items": {"$ref": "#PersonalizedProduct"}
          }
        }
      }
    },
    {
      "name": "CartItem",
      "version": "1.0.0",
      "description": "Item in a shopping cart",
      "schema": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "quantity": {"type": "integer"},
          "price": {"type": "number"},
          "subtotal": {"type": "number"}
        }
      }
    },
    {
      "name": "CartSummary",
      "version": "1.0.0",
      "description": "Shopping cart contents and total",
      "schema": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {"$ref": "#CartItem"}
          },
          "total": {"type": "number"},
          "item_count": {"type": "integer"}
        }
      }
    },
    {
      "name": "StockSummary",
      "version": "1.0.0",
      "description": "Inventory status summary for merchandisers",
      "schema": {
        "type": "object",
        "properties": {
          "total_products": {"type": "integer"},
          "total_units": {"type": "integer"},
          "low_stock_count": {"type": "integer"},
          "out_of_stock_count": {"type": "integer"}
        }
      }
    },
    {
      "name": "ProductQueryInput",
      "version": "1.0.0",
      "description": "Common input for product searches",
      "schema": {
        "type": "object",
        "properties": {
          "query": {"type": "string", "description": "What are you looking for?"},
          "category": {"type": "string", "description": "Optional category filter"}
        },
        "required": ["query"]
      }
    },
    {
      "name": "PersonalizedSearchInput",
      "version": "1.0.0",
      "description": "Input for personalized search",
      "schema": {
        "type": "object",
        "properties": {
          "query": {"type": "string", "description": "Search query"},
          "user_id": {"type": "string", "description": "User ID for personalization"},
          "limit": {"type": "integer", "description": "Max results", "default": 10}
        },
        "required": ["query"]
      }
    },
    {
      "name": "ProductIdInput",
      "version": "1.0.0",
      "description": "Input requiring a product ID",
      "schema": {
        "type": "object",
        "properties": {
          "product_id": {"type": "string", "description": "Product ID"}
        },
        "required": ["product_id"]
      }
    },
    {
      "name": "AddToCartInput",
      "version": "1.0.0",
      "description": "Input for adding item to cart",
      "schema": {
        "type": "object",
        "properties": {
          "product_id": {"type": "string", "description": "Product ID to add"},
          "quantity": {"type": "integer", "description": "How many (default: 1)"}
        },
        "required": ["product_id"]
      }
    },
    {
      "name": "RestockRecommendation",
      "version": "1.0.0",
      "description": "A single product restock recommendation with supplier quote",
      "schema": {
        "type": "object",
        "properties": {
          "product_id": {"type": "string"},
          "product_name": {"type": "string"},
          "current_stock": {"type": "integer"},
          "reorder_threshold": {"type": "integer"},
          "deficit": {"type": "integer", "description": "Units needed to reach threshold"},
          "recommended_supplier": {
            "type": "object",
            "properties": {
              "supplier_id": {"type": "string"},
              "supplier_name": {"type": "string"},
              "unit_price": {"type": "number"},
              "total_price": {"type": "number"},
              "lead_time_days": {"type": "integer"},
              "reliability_score": {"type": "number"}
            }
          },
          "urgency": {"type": "string", "enum": ["critical", "high", "medium", "low"]}
        }
      }
    },
    {
      "name": "RestockPlanOutput",
      "version": "1.0.0",
      "description": "Complete restock plan with prioritized recommendations",
      "schema": {
        "type": "object",
        "properties": {
          "recommendations": {
            "type": "array",
            "items": {"$ref": "#RestockRecommendation"}
          },
          "total_items": {"type": "integer"},
          "total_estimated_cost": {"type": "number"},
          "summary": {"type": "string"}
        }
      }
    }
  ],

  "servers": [
    {
      "name": "catalog-service",
      "version": "1.0.0",
      "description": "Product catalog with search and browse capabilities",
      "provides": [
        { "tool": "search_products", "version": "1.0.0" },
        { "tool": "list_products", "version": "1.0.0" },
        { "tool": "get_product", "version": "1.0.0" },
        { "tool": "get_categories", "version": "1.0.0" },
        { "tool": "search_index", "version": "1.0.0" },
        { "tool": "hydrate_products", "version": "1.0.0" },
        { "tool": "personalize_ranking", "version": "1.0.0" }
      ],
      "metadata": {
        "owner": "catalog-team",
        "healthEndpoint": "/health"
      }
    },
    {
      "name": "cart-service",
      "version": "1.0.0",
      "description": "Shopping cart management",
      "provides": [
        { "tool": "view_cart", "version": "1.0.0" },
        { "tool": "add_to_cart", "version": "1.0.0" },
        { "tool": "update_cart_item", "version": "1.0.0" },
        { "tool": "remove_from_cart", "version": "1.0.0" },
        { "tool": "clear_cart", "version": "1.0.0" }
      ]
    },
    {
      "name": "order-service",
      "version": "1.0.0",
      "description": "Order processing and management",
      "provides": [
        { "tool": "checkout", "version": "1.0.0" },
        { "tool": "get_order", "version": "1.0.0" },
        { "tool": "list_orders", "version": "1.0.0" },
        { "tool": "get_sales_report", "version": "1.0.0" },
        { "tool": "update_order_status", "version": "1.0.0" }
      ]
    },
    {
      "name": "inventory-service",
      "version": "1.0.0",
      "description": "Stock tracking and inventory management",
      "provides": [
        { "tool": "check_stock", "version": "1.0.0" },
        { "tool": "get_inventory_report", "version": "1.0.0" },
        { "tool": "get_low_stock_alerts", "version": "1.0.0" },
        { "tool": "adjust_inventory", "version": "1.0.0" }
      ]
    },
    {
      "name": "supplier-service",
      "version": "1.0.0",
      "description": "Supplier and purchase order management",
      "provides": [
        { "tool": "list_suppliers", "version": "1.0.0" },
        { "tool": "get_supplier", "version": "1.0.0" },
        { "tool": "create_purchase_order", "version": "1.0.0" },
        { "tool": "list_purchase_orders", "version": "1.0.0" },
        { "tool": "receive_shipment", "version": "1.0.0" },
        { "tool": "get_all_quotes", "version": "1.0.0" }
      ]
    }
  ],

  "tools": [
    {
      "name": "find_products",
      "description": "Search for products using natural language (e.g., 'comfortable running shoes under $100')",
      "source": {
        "target": "catalog-service",
        "tool": "search_products",
        "defaults": {
          "in_stock_only": true,
          "limit": 8
        },
        "hideFields": ["include_embeddings", "debug_scores", "sort_order", "page"]
      },
      "inputSchema": {"$ref": "#ProductQueryInput"},
      "outputSchema": {"$ref": "#ProductListOutput"},
      "outputTransform": {
        "mappings": {
          "products": {"path": "$.products"},
          "total_found": {"path": "$.results_count"}
        }
      }
    },

    {
      "name": "my_cart",
      "description": "See what's in your shopping cart",
      "source": {
        "target": "cart-service",
        "tool": "view_cart",
        "defaults": {
          "user_id": "web-user"
        }
      },
      "inputSchema": {
        "type": "object",
        "properties": {},
        "additionalProperties": false
      },
      "outputSchema": {"$ref": "#CartSummary"},
      "outputTransform": {
        "mappings": {
          "items": {"path": "$.items"},
          "total": {"path": "$.total"},
          "item_count": {"path": "$.item_count"}
        }
      }
    },

    {
      "name": "add_item",
      "description": "Add a product to your cart",
      "source": {
        "target": "cart-service",
        "tool": "add_to_cart",
        "defaults": {
          "user_id": "web-user",
          "quantity": 1
        }
      },
      "inputSchema": {"$ref": "#AddToCartInput"}
    },

    {
      "name": "stock_status",
      "description": "Quick inventory status check for merchandisers",
      "source": {
        "target": "inventory-service",
        "tool": "get_inventory_report"
      },
      "outputSchema": {"$ref": "#StockSummary"},
      "outputTransform": {
        "mappings": {
          "total_products": {"path": "$.summary.total_products"},
          "total_units": {"path": "$.summary.total_units"},
          "low_stock_count": {"path": "$.summary.low_stock_count"},
          "out_of_stock_count": {"path": "$.summary.out_of_stock_count"}
        }
      }
    },


    {
      "name": "personalized_search",
      "description": "Search products and personalize results based on your preferences",
      "spec": {
        "pipeline": {
          "steps": [
            {
              "id": "search",
              "operation": {"tool": {"name": "search_index", "server": "catalog-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "hydrate",
              "operation": {"tool": {"name": "hydrate_products", "server": "catalog-service"}},
              "input": {
                "construct": {
                  "fields": {
                    "product_ids": {"step": {"stepId": "search", "path": "$.matches[*].id"}},
                    "fields": {"constant": ["id", "name", "price", "category", "brand", "description", "image_url"]}
                  }
                }
              }
            },
            {
              "id": "personalize",
              "operation": {"tool": {"name": "personalize_ranking", "server": "catalog-service"}},
              "input": {
                "construct": {
                  "fields": {
                    "items": {"step": {"stepId": "hydrate", "path": "$.products"}},
                    "scores": {"step": {"stepId": "search", "path": "$.matches[*].score"}},
                    "user_id": {"input": {"path": "$.user_id"}}
                  }
                }
              }
            }
          ]
        }
      },
      "inputSchema": {"$ref": "#PersonalizedSearchInput"},
      "outputSchema": {"$ref": "#PersonalizedSearchOutput"},
      "outputTransform": {
        "mappings": {
          "products": {"path": "$.products"}
        }
      }
    },

    {
      "name": "product_with_availability",
      "description": "Get product details including real-time stock availability",
      "spec": {
        "pipeline": {
          "steps": [
            {
              "id": "product",
              "operation": {"tool": {"name": "get_product", "server": "catalog-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "stock",
              "operation": {"tool": {"name": "check_stock", "server": "inventory-service"}},
              "input": {
                "construct": {
                  "fields": {
                    "product_id": {"input": {"path": "$.product_id"}}
                  }
                }
              }
            }
          ]
        }
      },
      "inputSchema": {"$ref": "#ProductIdInput"}
    },




    {
      "name": "browse_products",
      "description": "Browse the product catalog with optional category filter",
      "source": {"target": "catalog-service", "tool": "list_products"}
    },
    {
      "name": "search_products",
      "description": "Search products using natural language queries",
      "source": {"target": "catalog-service", "tool": "search_products"}
    },
    {
      "name": "get_product_details",
      "description": "Get detailed information about a specific product",
      "source": {"target": "catalog-service", "tool": "get_product"}
    },
    {
      "name": "get_categories",
      "description": "Get all available product categories",
      "source": {"target": "catalog-service", "tool": "get_categories"}
    },
    {
      "name": "view_cart",
      "description": "View shopping cart contents and total",
      "source": {"target": "cart-service", "tool": "view_cart"}
    },
    {
      "name": "add_to_cart",
      "description": "Add a product to the shopping cart",
      "source": {"target": "cart-service", "tool": "add_to_cart"}
    },
    {
      "name": "update_cart_item",
      "description": "Update quantity of an item in cart",
      "source": {"target": "cart-service", "tool": "update_cart_item"}
    },
    {
      "name": "remove_from_cart",
      "description": "Remove an item from the cart",
      "source": {"target": "cart-service", "tool": "remove_from_cart"}
    },
    {
      "name": "clear_cart",
      "description": "Clear all items from cart",
      "source": {"target": "cart-service", "tool": "clear_cart"}
    },
    {
      "name": "checkout",
      "description": "Complete checkout and create an order",
      "source": {"target": "order-service", "tool": "checkout"}
    },
    {
      "name": "list_orders",
      "description": "List orders for a user",
      "source": {"target": "order-service", "tool": "list_orders"}
    },
    {
      "name": "get_order",
      "description": "Get details of a specific order",
      "source": {"target": "order-service", "tool": "get_order"}
    },
    {
      "name": "get_inventory_report",
      "description": "Get comprehensive inventory status report",
      "source": {"target": "inventory-service", "tool": "get_inventory_report"}
    },
    {
      "name": "get_low_stock_alerts",
      "description": "Get products below reorder threshold",
      "source": {"target": "inventory-service", "tool": "get_low_stock_alerts"}
    },
    {
      "name": "adjust_inventory",
      "description": "Manually adjust inventory levels",
      "source": {"target": "inventory-service", "tool": "adjust_inventory"}
    },
    {
      "name": "list_suppliers",
      "description": "Get all available suppliers",
      "source": {"target": "supplier-service", "tool": "list_suppliers"}
    },
    {
      "name": "get_supplier",
      "description": "Get supplier details",
      "source": {"target": "supplier-service", "tool": "get_supplier"}
    },
    {
      "name": "create_purchase_order",
      "description": "Create a purchase order to restock inventory",
      "source": {"target": "supplier-service", "tool": "create_purchase_order"}
    },
    {
      "name": "list_purchase_orders",
      "description": "List purchase orders with optional filtering",
      "source": {"target": "supplier-service", "tool": "list_purchase_orders"}
    },
    {
      "name": "receive_shipment",
      "description": "Mark a purchase order as received",
      "source": {"target": "supplier-service", "tool": "receive_shipment"}
    },
    {
      "name": "get_sales_report",
      "description": "Get sales analytics report",
      "source": {"target": "order-service", "tool": "get_sales_report"}
    },
    {
      "name": "update_order_status",
      "description": "Update order status",
      "source": {"target": "order-service", "tool": "update_order_status"}
    },


    {
      "name": "search_index",
      "description": "Fast index search returning IDs and relevance scores",
      "source": {"target": "catalog-service", "tool": "search_index"}
    },
    {
      "name": "hydrate_products",
      "description": "Fetch product details for a list of IDs",
      "source": {"target": "catalog-service", "tool": "hydrate_products"}
    },
    {
      "name": "personalize_ranking",
      "description": "Re-rank products based on user preferences",
      "source": {"target": "catalog-service", "tool": "personalize_ranking"}
    },
    {
      "name": "check_stock",
      "description": "Check stock level for a single product",
      "source": {"target": "inventory-service", "tool": "check_stock"}
    },
    {
      "name": "get_all_supplier_quotes",
      "description": "Get price quotes from all suppliers for a product",
      "source": {"target": "supplier-service", "tool": "get_all_quotes"}
    },


    {
      "name": "top_restock_quote",
      "description": "Get supplier quotes for the most critical low-stock product",
      "spec": {
        "pipeline": {
          "steps": [
            {
              "id": "alerts",
              "operation": {"tool": {"name": "get_low_stock_alerts", "server": "inventory-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "quotes",
              "operation": {"tool": {"name": "get_all_quotes", "server": "supplier-service"}},
              "input": {
                "construct": {
                  "fields": {
                    "product_id": {"step": {"stepId": "alerts", "path": "$.alerts[0].product_id"}},
                    "quantity": {"step": {"stepId": "alerts", "path": "$.alerts[0].deficit"}}
                  }
                }
              }
            }
          ]
        }
      },
      "inputSchema": {
        "type": "object",
        "properties": {
          "threshold": {"type": "integer", "description": "Optional custom stock threshold"}
        }
      },
      "outputTransform": {
        "mappings": {
          "product_id": {"path": "$.product_id"},
          "product_name": {"path": "$.product_name"},
          "quantity_needed": {"path": "$.quantity_requested"},
          "quotes": {"path": "$.quotes"},
          "best_price": {"path": "$.best_price"},
          "fastest_delivery": {"path": "$.fastest_delivery"}
        }
      }
    },


    {
      "name": "product_intelligence",
      "description": "Get complete product intelligence: details, inventory status, and supplier options",
      "spec": {
        "pipeline": {
          "steps": [
            {
              "id": "product",
              "operation": {"tool": {"name": "get_product", "server": "catalog-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "stock",
              "operation": {"tool": {"name": "check_stock", "server": "inventory-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "quotes",
              "operation": {"tool": {"name": "get_all_quotes", "server": "supplier-service"}},
              "input": {
                "construct": {
                  "fields": {
                    "product_id": {"input": {"path": "$.product_id"}},
                    "quantity": {"constant": 50}
                  }
                }
              }
            }
          ]
        }
      },
      "inputSchema": {"$ref": "#ProductIdInput"}
    },


    {
      "name": "order_with_context",
      "description": "Get order details with sales context and inventory impact",
      "spec": {
        "pipeline": {
          "steps": [
            {
              "id": "order",
              "operation": {"tool": {"name": "get_order", "server": "order-service"}},
              "input": {"input": {"path": "$"}}
            },
            {
              "id": "sales",
              "operation": {"tool": {"name": "get_sales_report", "server": "order-service"}},
              "input": {"constant": {}}
            },
            {
              "id": "inventory",
              "operation": {"tool": {"name": "get_inventory_report", "server": "inventory-service"}},
              "input": {"constant": {}}
            }
          ]
        }
      },
      "inputSchema": {
        "type": "object",
        "properties": {
          "order_id": {"type": "string", "description": "Order ID to look up"}
        },
        "required": ["order_id"]
      }
    }
  ],

  "agents": [
    {
      "name": "customer-agent",
      "version": "1.0.0",
      "description": "Customer-facing shopping assistant (Google ADK)",
      "url": "http://localhost:9001",
      "capabilities": {
        "streaming": true,
        "extensions": [
          {
            "uri": "urn:agentgateway:sbom",
            "description": "Tool dependencies for scoped discovery",
            "params": {
              "depends": [
                { "type": "tool", "name": "virtual_find_products", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_browse_products", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_product_details", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_my_cart", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_add_to_cart", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_add_item", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_remove_from_cart", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_view_cart", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_checkout", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_list_orders", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_order", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_personalized_search", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_product_with_availability", "version": "1.0.0" }
              ]
            }
          }
        ]
      },
      "metadata": {
        "framework": "google-adk",
        "owner": "customer-experience-team"
      }
    },
    {
      "name": "merchandiser-agent",
      "version": "1.0.0",
      "description": "Internal merchandiser assistant for inventory and suppliers (LangGraph)",
      "url": "http://localhost:9002",
      "capabilities": {
        "streaming": true,
        "extensions": [
          {
            "uri": "urn:agentgateway:sbom",
            "description": "Tool dependencies for scoped discovery",
            "params": {
              "depends": [
                { "type": "tool", "name": "virtual_stock_status", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_inventory_report", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_low_stock_alerts", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_adjust_inventory", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_check_stock", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_list_suppliers", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_supplier", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_create_purchase_order", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_list_purchase_orders", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_receive_shipment", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_all_supplier_quotes", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_sales_report", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_update_order_status", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_list_orders", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_order", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_browse_products", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_product_details", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_get_categories", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_top_restock_quote", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_product_intelligence", "version": "1.0.0" },
                { "type": "tool", "name": "virtual_order_with_context", "version": "1.0.0" }
              ]
            }
          }
        ]
      },
      "metadata": {
        "framework": "langgraph",
        "owner": "supply-chain-team"
      }
    }
  ]
}
